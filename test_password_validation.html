<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validation Mots de Passe eConsulat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .password-examples {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .password-examples h3 {
            margin-top: 0;
            color: #333;
        }
        .password-examples ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .password-examples li {
            margin-bottom: 5px;
            font-family: monospace;
        }
        .valid {
            color: #28a745;
            font-weight: bold;
        }
        .invalid {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Test Validation Mots de Passe eConsulat</h1>
        <p>Ce fichier teste la nouvelle validation des mots de passe apr√®s les corrections.</p>

        <div class="password-examples">
            <h3>üìã R√®gles de Validation des Mots de Passe</h3>
            <ul>
                <li><strong>Longueur :</strong> Minimum 6 caract√®res, maximum 100</li>
                <li><strong>Contenu :</strong> Au moins une lettre ET un chiffre</li>
                <li><strong>Caract√®res sp√©ciaux :</strong> Optionnels mais recommand√©s</li>
            </ul>
            
            <h4>‚úÖ Exemples de Mots de Passe Valides :</h4>
            <ul>
                <li class="valid">password123</li>
                <li class="valid">MotDePasse456</li>
                <li class="valid">abc123</li>
                <li class="valid">123abc</li>
                <li class="valid">MotDePasse123!</li>
            </ul>
            
            <h4>‚ùå Exemples de Mots de Passe Invalides :</h4>
            <ul>
                <li class="invalid">123456 (pas de lettres)</li>
                <li class="invalid">abcdef (pas de chiffres)</li>
                <li class="invalid">abc12 (trop court)</li>
                <li class="invalid">123 (trop court)</li>
            </ul>
        </div>

        <div class="form-group">
            <label for="firstName">Pr√©nom:</label>
            <input type="text" id="firstName" value="Test" required>
        </div>

        <div class="form-group">
            <label for="lastName">Nom:</label>
            <input type="text" id="lastName" value="User" required>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="test@example.com" required>
        </div>

        <div class="form-group">
            <label for="password">Mot de passe:</label>
            <input type="password" id="password" value="password123" required>
            <small>Doit contenir au moins 6 caract√®res avec au moins une lettre et un chiffre</small>
        </div>

        <div>
            <button onclick="testValidPassword()">Test Mot de Passe Valide</button>
            <button onclick="testInvalidPasswords()">Test Mots de Passe Invalides</button>
            <button onclick="testCommonPasswords()">Test Mots de Passe Courants</button>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }

        async function testValidPassword() {
            try {
                const data = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                };

                console.log('üì§ Test avec mot de passe valide:', data.password);

                const response = await fetch('http://localhost:8080/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                console.log('üì• R√©ponse re√ßue:', response.status, response.statusText);

                const result = await response.json();
                console.log('üì• Corps de la r√©ponse:', result);

                if (response.ok) {
                    showResult(`‚úÖ Inscription r√©ussie avec le mot de passe: "${data.password}"\n\nR√©ponse compl√®te:\n${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Erreur ${response.status}: ${result.error || 'Erreur inconnue'}\n\nR√©ponse compl√®te:\n${JSON.stringify(result, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Erreur de connexion: ${error.message}`, 'error');
            }
        }

        async function testInvalidPasswords() {
            const invalidPasswords = [
                "123456",      // Pas de lettres
                "abcdef",      // Pas de chiffres
                "abc12",       // Trop court
                "123",         // Trop court
                "",            // Vide
                "a1",          // Trop court
                "12345",       // Trop court, pas de lettres
                "abcde"        // Trop court, pas de chiffres
            ];

            let results = "üß™ Test des mots de passe invalides :\n\n";

            for (const password of invalidPasswords) {
                try {
                    const data = {
                        firstName: "Test",
                        lastName: "User",
                        email: `test-${Date.now()}-${Math.random()}@example.com`,
                        password: password
                    };

                    console.log(`üì§ Test avec mot de passe invalide: "${password}"`);

                    const response = await fetch('http://localhost:8080/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (response.status === 400) {
                        results += `‚úÖ "${password}" ‚Üí Erreur 400 attendue: ${result.error || result.password || 'Erreur de validation'}\n`;
                    } else {
                        results += `‚ö†Ô∏è "${password}" ‚Üí Statut inattendu ${response.status}: ${result.error || 'Erreur inconnue'}\n`;
                    }

                    // Attendre un peu entre les tests pour √©viter de surcharger le serveur
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    results += `‚ùå "${password}" ‚Üí Erreur de connexion: ${error.message}\n`;
                }
            }

            showResult(results, 'info');
        }

        async function testCommonPasswords() {
            const commonPasswords = [
                "password123",     // Valide
                "123456789",       // Invalide (pas de lettres)
                "qwerty123",       // Valide
                "admin123",        // Valide
                "letmein123",      // Valide
                "welcome123",      // Valide
                "monkey123",       // Valide
                "dragon123"        // Valide
            ];

            let results = "üîê Test des mots de passe courants :\n\n";

            for (const password of commonPasswords) {
                try {
                    const data = {
                        firstName: "Test",
                        lastName: "User",
                        email: `test-${Date.now()}-${Math.random()}@example.com`,
                        password: password
                    };

                    console.log(`üì§ Test avec mot de passe courant: "${password}"`);

                    const response = await fetch('http://localhost:8080/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        results += `‚úÖ "${password}" ‚Üí Inscription r√©ussie\n`;
                    } else if (response.status === 400) {
                        results += `‚ùå "${password}" ‚Üí Erreur 400: ${result.error || result.password || 'Erreur de validation'}\n`;
                    } else {
                        results += `‚ö†Ô∏è "${password}" ‚Üí Statut ${response.status}: ${result.error || 'Erreur inconnue'}\n`;
                    }

                    // Attendre un peu entre les tests
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    results += `‚ùå "${password}" ‚Üí Erreur de connexion: ${error.message}\n`;
                }
            }

            showResult(results, 'info');
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Test de validation des mots de passe initialis√©');
            console.log('üìã Instructions:');
            console.log('1. Assurez-vous que le serveur backend est d√©marr√© sur le port 8080');
            console.log('2. Testez d\'abord avec un mot de passe valide');
            console.log('3. Puis testez les mots de passe invalides pour v√©rifier la validation');
        });
    </script>
</body>
</html>
